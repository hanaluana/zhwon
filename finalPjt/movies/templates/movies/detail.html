{% extends 'base.html' %}
{% load bootstrap4 %}

{% block body %}
  <div class="row">
    
    <div class="card col-6" style="width: 18rem;" >
      <img src="{{movie.poster_image}}" class="card-img-top" alt="movie.title">
    </div>
    
    <div class="card col-6" style="width: 18rem;">
      <div class="card-body">
        <h5 class="card-title">{{movie.title}}</h5>
        
        <p>장르: {% for genre in movie.genre.all %}
          {{genre.name}} 
          {% endfor %}
        </p>
      
        <p>감독: {{movie.director}}</p>
      </div>
    </div>
  </div>
  
  <!--현재 사용자가 리뷰를 남겨본 적이 없는 경우-->
  {% if check %}
    <!--별점-->
    <x-star-rating value="3" number="5"></x-star-rating>
    <script src="StarRating.js"></script>
    
    <form method="POST" action="{% url 'movies:create_rating' movie.id%}" class="d-inline">
    <!--bootstrap Form-->
    {% csrf_token %}
    {% bootstrap_form rating_form %}
    <button type="submit" class="btn btn-primary" style="float:right">submit</button>
    </form>
  {% endif %}
  <!--모든 평점 보여주기-->
  <ul class="list-group">
    {% for rating in movie.rating_set.all %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
      <strong>{{rating.user}}</strong>
      {{rating.comment}}
      <span class="badge badge-primary badge-pill">{{rating.score}}</span>
      {% if user == rating.user %}
        <form class="d-inline-block" action={% url 'movies:delete_rating' movie.id rating.id %} method="POST">
          {% csrf_token %}
           <button type="submit" class="btn btn-danger">삭제</button>
        </form>
        <a href={% url 'movies:update_rating' movie.id rating.id %} class="btn btn-warning">수정</a>
      {% endif %}
      </li>    
    {% endfor %}
  </ul>
  
{% endblock %}